<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - SMART THITTAM</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <main>
        <div class="container" style="max-width:700px;margin:2rem auto;">
            <div class="card fade-in" style="padding:2rem;">
                <h2 class="section-title mb-4">Admin Panel</h2>
                <h3>Add Scheme</h3>
                <form id="addSchemeForm">
                    <input type="text" id="name" name="name" class="input" placeholder="Title" required>
                    <input type="text" id="description" name="description" class="input" placeholder="Description" required>
                    <input type="text" id="category" name="category" class="input" placeholder="Category" required>
                    <select id="district" name="district" class="input" required>
                        <option value="All Districts">All Districts</option>
                        <option value="Chennai">Chennai</option>
                        <option value="Coimbatore">Coimbatore</option>
                        <option value="Madurai">Madurai</option>
                        <option value="Salem">Salem</option>
                        <option value="Tiruchirappalli">Tiruchirappalli</option>
                        <option value="Vellore">Vellore</option>
                        <option value="Erode">Erode</option>
                        <option value="Tiruppur">Tiruppur</option>
                        <option value="Tirunelveli">Tirunelveli</option>
                        <option value="Thoothukkudi">Thoothukkudi</option>
                        <option value="Dindigul">Dindigul</option>
                        <option value="Thanjavur">Thanjavur</option>
                        <option value="Villupuram">Villupuram</option>
                        <option value="Kanchipuram">Kanchipuram</option>
                        <option value="Cuddalore">Cuddalore</option>
                        <option value="Pudukkottai">Pudukkottai</option>
                        <option value="Sivaganga">Sivaganga</option>
                        <option value="Ramanathapuram">Ramanathapuram</option>
                        <option value="Virudhunagar">Virudhunagar</option>
                        <option value="Karur">Karur</option>
                        <option value="Namakkal">Namakkal</option>
                        <option value="Theni">Theni</option>
                        <option value="Krishnagiri">Krishnagiri</option>
                        <option value="Dharmapuri">Dharmapuri</option>
                        <option value="Tiruvannamalai">Tiruvannamalai</option>
                        <option value="Ariyalur">Ariyalur</option>
                        <option value="Perambalur">Perambalur</option>
                        <option value="Nagapattinam">Nagapattinam</option>
                        <option value="Tiruvarur">Tiruvarur</option>
                        <option value="Nilgiris">Nilgiris</option>
                        <option value="Tenkasi">Tenkasi</option>
                        <option value="Chengalpattu">Chengalpattu</option>
                        <option value="Ranipet">Ranipet</option>
                        <option value="Tirupathur">Tirupathur</option>
                        <option value="Mayiladuthurai">Mayiladuthurai</option>
                        <option value="Kallakurichi">Kallakurichi</option>
                    </select>
                    <input type="number" id="amount" name="amount" class="input" placeholder="Amount" required>
                    <input type="number" name="minAge" class="input" placeholder="Min Age" required>
                    <input type="number" name="maxAge" class="input" placeholder="Max Age" required>
                    <button type="submit" class="btn btn-primary w-full">Add Scheme</button>
                </form>
                <hr class="my-4">
                <h3>Edit/Delete Scheme</h3>
                <input type="text" id="schemeId" class="input" placeholder="Scheme ID">
                <button onclick="editScheme()" class="btn btn-secondary">Edit</button>
                <button onclick="deleteScheme()" class="btn btn-secondary">Delete</button>
            </div>
        </div>
    </main>
    <script>
    const user = JSON.parse(localStorage.getItem('user'));
if (!user || user.role !== 'admin') {
    alert('Access denied! Only admin can view this page.');
    window.location.href = 'index.html'; // Redirect to home
}

// Add Scheme
document.getElementById('addSchemeForm').onsubmit = async (e) => {
    e.preventDefault();
    const user = JSON.parse(localStorage.getItem('user'));
    const token = user?.token;
    if (!token) {
        alert('You must be logged in as admin.');
        return;
    }
    const form = e.target;
const formData = {
    name: form.elements['name'].value,
    description: form.elements['description'].value,
    category: form.elements['category'].value,
    district: form.elements['district'].value,
    amount: form.elements['amount'].value,
    minAge: form.elements['minAge'].value,
    maxAge: form.elements['maxAge'].value,
};
    const res = await fetch('http://localhost:5001/api/v2/schemes', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(formData)
    });
    const result = await res.json();
    alert(result.message || 'Failed to add scheme');
};

// Edit Scheme
async function editScheme() {
    const schemeId = document.getElementById('schemeId').value;
    const token = user?.token;
    const newTitle = prompt('Enter new title:');
    if (!schemeId || !newTitle) return;
    const res = await fetch(`http://localhost:5001/api/v2/schemes/update/${schemeId}`, {
        method: 'PUT',
        headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}` // Add this line
        },
        body: JSON.stringify({ title: newTitle })
    });
    const result = await res.json();
    alert(result.message);
}

// Delete Scheme
async function deleteScheme() {
    const schemeId = document.getElementById('schemeId').value;
    const token = user?.token;
    if (!schemeId) return;
    const res = await fetch(`http://localhost:5001/api/v2/schemes/delete/${schemeId}`, {
        method: 'DELETE',
        headers: {
            'Authorization': `Bearer ${token}` // Add this line
        }
    });
    const result = await res.json();
    alert(result.message);
}
    </script>
</body>
</html>